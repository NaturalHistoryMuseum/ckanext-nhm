{% ckan_extends %}

{% import 'macros/form.html' as form %}

{% block contact_form_fields %}

    {{ form.input('name', label=_('Your name'), id='field-name', value=data.name, error=errors.name, classes=['control-medium'], is_required=true) }}

    {{ form.input('email', label=_('Your email'), id='field-email', type='email', value=data.email, error=errors.email, classes=['control-medium'], is_required=true) }}

    {# Add resource name and ID hidden field#}

    {% set package_id = h.get_request_param('package_id', None) %}

    {% if package_id %}

        {% set package = h.get_package(package_id) %}

        <div class="control-group control-medium">
            <label class="control-label">Dataset</label>
            <div class="controls ">
                <p>{{ package['title'] or package['name'] }}</p>
            </div>
        </div>

        {{ form.hidden('package_id', package_id) }}

    {% endif %}

    {# Add resource name and ID hidden field#}

    {% set resource_id = h.get_request_param('resource_id', None) %}

    {% if resource_id %}

        {% set resource = h.get_resource(resource_id) %}

        <div class="control-group control-medium">
            <label class="control-label">Resource</label>
            <div class="controls ">
                <p>{{ resource['name'] or resource['id'] }}</p>
            </div>
        </div>

        {{ form.hidden('resource_id', resource_id) }}

    {% endif %}

    {# Add record name and record ID hidden field#}

    {% set record_id = h.get_request_param('record_id', None) %}

    {% if record_id and resource %}

        {% set record = h.get_record(resource_id, record_id) %}

            {% if record %}

                {# Add title of record #}
                <div class="control-group control-medium">
                    <label class="control-label">Record</label>
                    <div class="controls ">

                        <p>
                            {% if record['Catalog number'] %}
                                {{ record['Catalog number'] }}
                            {% elif record['Occurrence ID'] %}
                                {{ record['Occurrence ID'] }}
                            {% else %}
                                {{ record['_id'] }}
                            {% endif %}
                        </p>

                    </div>
                </div>

            {% endif %}

        {{ form.hidden('record_id', record_id) }}

    {% endif %}

    {{ form.markdown('content', label=_('Your request'), id='field-content', value=data.content, error=errors.content, is_required=true) }}

{% endblock %}
