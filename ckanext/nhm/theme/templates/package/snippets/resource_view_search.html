{% import 'macros/form.html' as form %}

{# Added to resource_view_filters.html - full text search #}

{% set placeholder = _('Enter search text') %}
{% set q = request.str_GET.get('q') or '' %}
{% set action = h.url_for(controller='package', action='resource_read', id=package['name'], resource_id=resource['id'], view_id=resource_view['id']) %}
{% set query_params = h.get_query_params() %}
{% set filter_pills = h.get_resource_filter_pills(package, resource, resource_view) %}

<div class="row resource-view-filter-form">
    <form class="module-content search-form" method="get">

            <div class="span9">
                <div class="search-input control-group">
                  <input type="text" class="search" name="q" autocomplete="off" value="{{ q.decode('utf-8') }}" placeholder="{% block search_placeholder %}{{ placeholder }}{% endblock %}" />
                  <input type="hidden" name="view_id" value="{{ resource_view['id'] }}" />
                  {% if query_params['filters'] %}
                      <input type="hidden" name="filters" value="{{ query_params['filters'] }}" />
                  {% endif %}
                  <button type="submit">
                    <i class="fa fa-search"></i>
                    <span>{{ _('Search') }}</span>
                  </button>
                </div>
             </div>
            <div class="span3 no-margin">
                <div
                  class="resource-view-field-filters"
                  data-module="resource-view-field-filters"
                  data-module-resource-id="{{ resource['id'] }}"
                  data-module-fields="{{ h.dump_json(h.resource_view_get_filterable_fields(resource)) }}"
                  data-module-field-groups="{{ h.dump_json(h.resource_view_get_field_groups(resource)) }}"
                ></div>

            </div>
    </form>

    {% if filter_pills %}

        <div class="row resource-view-filter-pills">
            <div class="span12">
                <p class="filtered-list">
                    {% for pill in filter_pills %}
                <div class="filter">
                    <div class="facet">{{ pill.label }}:</div>
                    <div class="filtered pill">
                        <div class="pill-txt">{{ pill.value }}</div>
                        <div class="pill-remove">
                            <a href="{{ pill.href }}" class="remove" title="{{ _('Remove') }}"><i class="fa fa-remove"></i></a>
                        </div>
                    </div>
                </div>


                    {% endfor %}
                </p>
            </div>
        </div>

    {% endif %}

    {% resource 'ckanext-nhm/resource-view-field-filters' %}


</div>



