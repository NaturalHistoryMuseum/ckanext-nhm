{% block resource_read_url %}{% endblock %}

{% block breadcrumb_content %}
    {% set dataset = pkg.title or pkg.name %}
    <li>{% link_for _('Data'), controller='package', action='search' %}</li>
    <li>{% link_for dataset|truncate(30), controller='package', action='read', id=pkg.name %}</li>
    {# Added actual URL as IE9 doesn't like empty hrefs & we want to remvoe the filters #}
    <li class="active"><a href="{{ h.url_for(controller='package', action='resource_read', id=pkg.name, resource_id=res.id) }}">{{ h.resource_display_name(res)|truncate(30) }}</a></li>
{% endblock %}

{% block resource_additional_information %}

    {% if pkg.doi %}
        {% snippet "doi/snippets/resource_citation.html", pkg_dict=pkg, res=res %}
    {% endif %}

    <div class="additional-info">
        {% if res %}
            <section class="module">
                {% block resource_additional_information_inner %}
                    <div class="module-content">
                        <h3>{{ _('Additional Information') }}</h3>
                        <table class="table table-striped table-bordered table-condensed" data-module="table-toggle-more">
                            <tbody>
                            <tr>
                                <th scope="row">{{ _('Last updated') }}</th>
                                <td>{{ h.render_datetime(res.last_modified) or h.render_datetime(res.revision_timestamp) or h.render_datetime(res.created) or _('unknown') }}</td>
                            </tr>
                            <tr>
                                <th scope="row">{{ _('Created') }}</th>
                                <td>{{ h.render_datetime(res.created) or _('unknown') }}</td>
                            </tr>
                            <tr>
                                <th scope="row">{{ _('Format') }}</th>
                                <td>{{ res.mimetype_inner or res.mimetype or res.format or _('unknown') }}</td>
                            </tr>
                            <tr>
                                <th scope="row">{{ _('License') }}</th>
                                <td>{% snippet "snippets/license.html", pkg_dict=pkg, text_only=True %}</td>
                            </tr>
                            {% for key, value in h.format_resource_items(res.items()) %}
                                {% if h.filter_resource_items(key) %}
                                    <tr class="toggle-more">
                                        <th scope="row">{{ key }}</th>
                                        <td>{{ value }}</td>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% endblock %}
            </section>
        {% endif %}
    </div>
{% endblock %}

{% block resource_actions_inner %}

    {% if h.check_access('package_update', {'id':pkg.id }) %}
        <li>{% link_for _('Manage'), controller='package', action='resource_edit', id=pkg.name, resource_id=res.id, class_='btn', icon='wrench' %}</li>
    {% endif %}

        <li>{% snippet 'package/snippets/resource_link.html', res=res, pkg=pkg %}</li>

    {% if 'datastore' in g.plugins and res.datastore_active %}
        <li>{% snippet 'package/snippets/data_api_button.html', resource=res, datastore_root_url=c.datastore_api %}</li>
    {% endif %}

        <li>{% snippet "contact/snippets/modal_link.html", pkg=pkg, res=res %}</li>

{% endblock %}

{% block resource_license %}
    {% snippet "snippets/social.html", pkg_dict=pkg, res_dict=res %}
{% endblock %}

{% block resource_view_content %}
<div class="resource-view">

  {% set resource_preview = h.resource_preview(c.resource, c.package) %}
  {% set views_created = res.has_views or resource_preview %}
  {% if not views_created %}

    {# If this is a web link, just show it a link #}
    {% if res.url and not res.can_be_previewed and not res.on_same_domain and not res.url_type %}
        <a href="{{ res.url }}" class="external" target="_blank">{{ res.url }}</a>
    {% else %}
        {{ _("There are no views created for this resource yet.") }}
    {% endif %}

  {% else %}
    {% if resource_preview and not current_resource_view %}
      {{ h.resource_preview(c.resource, c.package) }}
    {% else %}
      {% for resource_view in resource_views %}
        {% if resource_view == current_resource_view %}
          {% snippet 'package/snippets/resource_view.html',
             resource_view=resource_view,
             resource=c.resource,
             package=c.package
           %}
        {% endif %}
      {% endfor %}
    {% endif %}
  {% endif %}
</div>
{% endblock %}