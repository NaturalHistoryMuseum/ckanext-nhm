{% extends "record/specimen.html" %}

{% block content_primary_nav %}
    {% if g.additional_view %}

        {{ h.build_nav_icon('record', _('Normal view'), package_name=pkg.name, resource_id=res.id, record_id=rec._id) }}
        {{ h.build_nav_icon('dwc', _('Darwin Core view'), package_name=pkg.name, resource_id=res.id, record_id=rec._id) }}

    {% endif %}
{% endblock %}

{% macro dwc_row(term, uri=None) %}
    {%- set extra_html = caller() if caller -%}
    {% set value = g.record_dict[term] %}

    {% if not value %}
        {% set cls = 'empty' %}
        {% set value = '' %}
    {% else %}
        {% set cls = 'not-empty' %}
    {% endif %}

    <tr class="{{ cls }}">
        <th>

            {% if uri %}
                <a href="{{ uri }}" target="_blank" title="{{ uri }}">{{term}}</a>
            {% else %}
                {{term}}
            {% endif %}

        </th>

        <td>{{ value }}</td>
    </tr>

{% endmacro %}

{% block record_data %}

    <table class="toggle-empty-rows" data-module="toggle-empty-rows">

    {% for group, terms in g.dwc_terms.items() %}

        <thead>
            <tr>
                <th colspan="2">{{ group }}</th>
            </tr>
        </thead>

        <tbody>

            {% for uri, term in terms.items() %}
                 {{ dwc_row(term, uri) }}
            {% endfor %}

        </tbody>

    {% endfor %}

        <thead>
            <tr>
                <th colspan="2">Dynamic properties</th>
            </tr>
        </thead>

        {% for uri, properties in g.dynamic_properties.items() %}
            {% for property in properties %}
                {{ dwc_row(property) }}
            {% endfor %}
        {% endfor %}

    </table>

    {% resource 'ckanext-nhm/toggle-empty-rows' %}

{% endblock %}